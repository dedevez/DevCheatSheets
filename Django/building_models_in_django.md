# Cheat Sheet: Building a Model in Django

This cheat sheet provides a detailed guide for creating and managing models in Django, including best practices, security considerations, and useful tips.

---

## Table of Contents

1. [What is a Django Model?](#what-is-a-django-model)
2. [Creating a Model](#creating-a-model)
3. [Defining Fields](#defining-fields)
4. [Adding Metadata and Options](#adding-metadata-and-options)
5. [Creating and Applying Migrations](#creating-and-applying-migrations)
6. [Model Relationships](#model-relationships)
7. [Using Model Methods](#using-model-methods)
8. [Best Practices](#best-practices)
9. [Security Considerations](#security-considerations)
10. [Resources](#resources)

---

## What is a Django Model?

- A **Django model** is a Python class that represents a database table.
- Each attribute in the model corresponds to a column in the table.
- Django uses its Object-Relational Mapper (ORM) to interact with models.

---

## Creating a Model

1. Open your app's `models.py` file.
2. Define a Python class inheriting from `django.db.models.Model`.

### Example:

```python
from django.db import models

class BlogPost(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    published_at = models.DateTimeField(null=True, blank=True)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

---

## Defining Fields

Django provides several field types for database columns. Common ones include:

| Field Type        | Description                                |
| ----------------- | ------------------------------------------ |
| `CharField`       | A short text field, requires `max_length`. |
| `TextField`       | A large text field.                        |
| `IntegerField`    | Stores integers.                           |
| `FloatField`      | Stores floating-point numbers.             |
| `BooleanField`    | Stores `True` or `False`.                  |
| `DateTimeField`   | Stores date and time.                      |
| `EmailField`      | Stores and validates email addresses.      |
| `ForeignKey`      | Defines a one-to-many relationship.        |
| `ManyToManyField` | Defines a many-to-many relationship.       |
| `FileField`       | Stores file paths for uploaded files.      |

### Example with Options:

```python
class Product(models.Model):
    name = models.CharField(max_length=100, unique=True)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    is_active = models.BooleanField(default=True)
```

---

## Adding Metadata and Options

Metadata is added using the `class Meta` inside your model.

### Example:

```python
class BlogPost(models.Model):
    title = models.CharField(max_length=200)

    class Meta:
        ordering = ['-created_at']  # Sort by creation date descending
        verbose_name = "Blog Post"
        verbose_name_plural = "Blog Posts"
```

---

## Creating and Applying Migrations

1. Make migrations to generate database schema changes:

   ```bash
   python manage.py makemigrations
   ```

2. Apply the migrations:

   ```bash
   python manage.py migrate
   ```

3. Check the SQL generated by a migration:
   ```bash
   python manage.py sqlmigrate <app_name> <migration_name>
   ```

---

## Model Relationships

### One-to-Many (`ForeignKey`)

```python
class Author(models.Model):
    name = models.CharField(max_length=100)

class Post(models.Model):
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
```

### Many-to-Many (`ManyToManyField`)

```python
class Post(models.Model):
    title = models.CharField(max_length=200)
    tags = models.ManyToManyField('Tag')

class Tag(models.Model):
    name = models.CharField(max_length=50)
```

### One-to-One (`OneToOneField`)

```python
class Profile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
```

> **Tip**: Always set `on_delete` for foreign keys to define behavior when the related object is deleted.

---

## Using Model Methods

Add methods to encapsulate reusable logic.

### Example:

```python
class BlogPost(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()

    def summary(self):
        return self.content[:100]  # Return the first 100 characters
```

---

## Best Practices

1. **Use `auto_now_add` and `auto_now`**:

   - Use `auto_now_add=True` for created timestamps.
   - Use `auto_now=True` for updated timestamps.

2. **Validation**:

   - Use model-level validation with the `clean()` method.

   ```python
   def clean(self):
       if self.price < 0:
           raise ValidationError('Price cannot be negative')
   ```

3. **Indexes**:

   - Use `db_index=True` on fields frequently used in queries.

   ```python
   name = models.CharField(max_length=100, db_index=True)
   ```

4. **Unique Constraints**:

   - Use `unique=True` for fields requiring unique values.

5. **Verbose Names**:

   - Add human-readable names using `verbose_name` for models and fields.

6. **Avoid Hard Deletes**:
   - Use soft deletes with a `is_active` field instead of permanently deleting records.

---

## Security Considerations

1. **Avoid Sensitive Data in Models**:

   - Store sensitive data (e.g., passwords) securely using Djangoâ€™s built-in tools.

2. **Validation**:

   - Validate user input at the model level to prevent invalid data.

3. **Field Defaults**:

   - Set secure defaults for fields like `BooleanField` or `DateTimeField`.

4. **`on_delete` Behavior**:

   - Use `on_delete=models.PROTECT` for important foreign keys to prevent accidental deletions.

5. **SQL Injection Protection**:
   - Use Django's ORM to construct queries rather than raw SQL.

---

## Resources

- [Django Model Documentation](https://docs.djangoproject.com/en/stable/topics/db/models/)
- [Django QuerySet API](https://docs.djangoproject.com/en/stable/ref/models/querysets/)
- [Django Validators](https://docs.djangoproject.com/en/stable/ref/validators/)
- [Django Field Options](https://docs.djangoproject.com/en/stable/ref/models/fields/)
